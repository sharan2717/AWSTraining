"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handler = void 0;
const AWS = require("aws-sdk");
const client_s3_1 = require("@aws-sdk/client-s3");
const handler = async (event) => {
    const client = new client_s3_1.S3Client({});
    const bucketName = event.Records[0].s3.bucket.name;
    const s3ObjectKey = decodeURIComponent(event.Records[0].s3.object.key.replace(/\+/g, ' '));
    let csvContent = "";
    const command = new client_s3_1.GetObjectCommand({
        Bucket: "test-bucket",
        Key: "hello-s3.txt",
    });
    try {
        const response = await client.send(command);
        // The Body object also has 'transformToByteArray' and 'transformToWebStream' methods.
        if (response.Body) {
            const csvContent = await response.Body.transformToString();
        }
    }
    catch (err) {
        console.error(err);
    }
    calculateresults(csvContent);
    return {
        StatusCode: "200",
        Body: { "Message": "Results Calculated" }
    };
};
exports.handler = handler;
const calculateGrade = (mark) => {
    if (mark >= 90)
        return 'A+';
    else if (mark >= 80)
        return 'A';
    else if (mark >= 70)
        return 'B+';
    else if (mark >= 60)
        return 'B';
    else if (mark >= 40)
        return 'C';
    else
        return 'D';
};
function calculateGPA(marks) {
    const creditPoints = {
        Tamil: 1,
        English: 2,
        Maths: 3,
        Science: 2,
        Social: 2
    };
    const gradeValues = { 'A+': 10, 'A': 9, 'B+': 8, 'B': 7, 'C': 6, 'D': 5 };
    let totalCreditPoints = 0;
    let totalGradePoints = 0;
    for (const subject in marks) {
        const grade = calculateGrade(marks[subject]);
        const creditPoint = creditPoints[subject];
        const gradeValue = gradeValues[grade];
        totalCreditPoints += creditPoint;
        totalGradePoints += gradeValue * creditPoint;
    }
    return totalGradePoints / totalCreditPoints;
}
async function calculateresults(csvContent) {
    const rows = csvContent.split('\n').slice(1);
    const data = rows.map(row => {
        const [Name, Tamil, English, Maths, Science, Social] = row.split(',').map(item => item.trim());
        const GPA = calculateGPA({ Tamil: +Tamil, English: +English, Maths: +Maths, Science: +Science, Social: +Social });
        return {
            Name,
            Tamil: calculateGrade(+Tamil),
            English: calculateGrade(+English),
            Maths: calculateGrade(+Maths),
            Science: calculateGrade(+Science),
            Social: calculateGrade(+Social),
            GPA: GPA.toFixed(2)
        };
    });
    await AWSaddDocument(data);
    return data;
}
async function AWSaddDocument(data) {
    const ddb = new AWS.DynamoDB.DocumentClient();
    const params = {
        TableName: "Results",
        Item: data,
    };
    try {
        await ddb.put(params).promise();
        return params.Item;
    }
    catch (error) {
        console.error('Error adding document:', error);
        throw error;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUzNIYW5kbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiUzNIYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLCtCQUErQjtBQUsvQixrREFBZ0U7QUFFekQsTUFBTSxPQUFPLEdBQUMsS0FBSyxFQUFFLEtBQWEsRUFBQyxFQUFFO0lBQ3hDLE1BQU0sTUFBTSxHQUFHLElBQUksb0JBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUVoQyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ25ELE1BQU0sV0FBVyxHQUFHLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzVGLElBQU0sVUFBVSxHQUFVLEVBQUUsQ0FBQTtJQUMzQixNQUFNLE9BQU8sR0FBRyxJQUFJLDRCQUFnQixDQUFDO1FBQ2pDLE1BQU0sRUFBRSxhQUFhO1FBQ3JCLEdBQUcsRUFBRSxjQUFjO0tBQ3BCLENBQUMsQ0FBQztJQUNMLElBQUksQ0FBQztRQUNELE1BQU0sUUFBUSxHQUFHLE1BQU0sTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1QyxzRkFBc0Y7UUFDdEYsSUFBRyxRQUFRLENBQUMsSUFBSSxFQUFDLENBQUM7WUFDZCxNQUFNLFVBQVUsR0FBRyxNQUFNLFFBQVEsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUMvRCxDQUFDO0lBQ0gsQ0FBQztJQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFFUCxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUV6QixP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QUFDLE9BQU8sQ0FBQztZQUNqQyxNQUFNLEVBQUUsY0FBYyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQy9CLEdBQUcsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUN0QixDQUFDO0lBQ04sQ0FBQyxDQUFDLENBQUM7SUFDSCxNQUFNLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QixPQUFPLElBQUksQ0FBRTtBQUNoQixDQUFDO0FBRUEsS0FBSyxVQUFVLGNBQWMsQ0FBQyxJQUFXO0lBQ3RDLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUM5QyxNQUFNLE1BQU0sR0FBZ0I7UUFDMUIsU0FBUyxFQUFFLFNBQVM7UUFDcEIsSUFBSSxFQUFHLElBQWdDO0tBQzFDLENBQUM7SUFDQyxJQUFHLENBQUM7UUFDRCxNQUFNLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUE7UUFDL0IsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ3RCLENBQUM7SUFBQSxPQUFPLEtBQUssRUFBQyxDQUFDO1FBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMvQyxNQUFNLEtBQUssQ0FBQztJQUNoQixDQUFDO0FBQ0QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIEFXUyBmcm9tICdhd3Mtc2RrJztcclxuaW1wb3J0IHsgRGVsZXRlSXRlbU91dHB1dCwgR2V0SXRlbUlucHV0LCBQdXRJdGVtSW5wdXQsIFB1dEl0ZW1JbnB1dEF0dHJpYnV0ZU1hcCB9IGZyb20gJ2F3cy1zZGsvY2xpZW50cy9keW5hbW9kYic7XHJcbmltcG9ydCB7IFMzRXZlbnRTb3VyY2UgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbGFtYmRhLWV2ZW50LXNvdXJjZXMnO1xyXG5pbXBvcnQgeyBTM0V2ZW50LCBTM0hhbmRsZXIgfSBmcm9tICdhd3MtbGFtYmRhJztcclxuaW1wb3J0IHthd3NfczMgYXMgczMgfSBmcm9tICdhd3MtY2RrLWxpYic7XHJcbmltcG9ydCB7IEdldE9iamVjdENvbW1hbmQsIFMzQ2xpZW50IH0gZnJvbSBcIkBhd3Mtc2RrL2NsaWVudC1zM1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGhhbmRsZXI9YXN5bmMgKGV2ZW50OlMzRXZlbnQpPT57XHJcbiAgICBjb25zdCBjbGllbnQgPSBuZXcgUzNDbGllbnQoe30pO1xyXG5cclxuICAgIGNvbnN0IGJ1Y2tldE5hbWUgPSBldmVudC5SZWNvcmRzWzBdLnMzLmJ1Y2tldC5uYW1lO1xyXG4gICAgY29uc3QgczNPYmplY3RLZXkgPSBkZWNvZGVVUklDb21wb25lbnQoZXZlbnQuUmVjb3Jkc1swXS5zMy5vYmplY3Qua2V5LnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxuICAgbGV0ICAgY3N2Q29udGVudCA6c3RyaW5nPSBcIlwiXHJcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IEdldE9iamVjdENvbW1hbmQoe1xyXG4gICAgICAgIEJ1Y2tldDogXCJ0ZXN0LWJ1Y2tldFwiLFxyXG4gICAgICAgIEtleTogXCJoZWxsby1zMy50eHRcIixcclxuICAgICAgfSk7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LnNlbmQoY29tbWFuZCk7XHJcbiAgICAgICAgLy8gVGhlIEJvZHkgb2JqZWN0IGFsc28gaGFzICd0cmFuc2Zvcm1Ub0J5dGVBcnJheScgYW5kICd0cmFuc2Zvcm1Ub1dlYlN0cmVhbScgbWV0aG9kcy5cclxuICAgICAgICBpZihyZXNwb25zZS5Cb2R5KXtcclxuICAgICAgICAgICAgY29uc3QgY3N2Q29udGVudCA9IGF3YWl0IHJlc3BvbnNlLkJvZHkudHJhbnNmb3JtVG9TdHJpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgfSBcclxuXHJcbmNhbGN1bGF0ZXJlc3VsdHMoY3N2Q29udGVudClcclxuXHJcbiAgIHJldHVybiB7XHJcbiAgICBTdGF0dXNDb2RlIDogXCIyMDBcIixcclxuICAgIEJvZHk6e1wiTWVzc2FnZVwiIDogXCJSZXN1bHRzIENhbGN1bGF0ZWRcIn1cclxuICAgfTtcclxuXHJcbiAgICAgIFxyXG59XHJcblxyXG5jb25zdCBjYWxjdWxhdGVHcmFkZSA9IChtYXJrOiBudW1iZXIpID0+IHtcclxuICAgIGlmIChtYXJrID49IDkwKSByZXR1cm4gJ0ErJztcclxuICAgIGVsc2UgaWYgKG1hcmsgPj0gODApIHJldHVybiAnQSc7XHJcbiAgICBlbHNlIGlmIChtYXJrID49IDcwKSByZXR1cm4gJ0IrJztcclxuICAgIGVsc2UgaWYgKG1hcmsgPj0gNjApIHJldHVybiAnQic7XHJcbiAgICBlbHNlIGlmIChtYXJrID49IDQwKSByZXR1cm4gJ0MnO1xyXG4gICAgZWxzZSByZXR1cm4gJ0QnO1xyXG4gIH07XHJcblxyXG5cclxuXHJcbiAgZnVuY3Rpb24gY2FsY3VsYXRlR1BBKG1hcmtzOmFueSkge1xyXG4gICAgY29uc3QgY3JlZGl0UG9pbnRzOmFueSA9IHsgXHJcbiAgICAgICAgVGFtaWw6IDEsIFxyXG4gICAgICAgIEVuZ2xpc2g6IDIsIFxyXG4gICAgICAgIE1hdGhzOiAzLFxyXG4gICAgICAgICBTY2llbmNlOiAyLFxyXG4gICAgICAgICAgU29jaWFsOiAyXHJcbiAgICAgICAgIH07XHJcbiAgICBjb25zdCBncmFkZVZhbHVlcyA9IHsgJ0ErJzogMTAsICdBJzogOSwgJ0IrJzogOCwgJ0InOiA3LCAnQyc6IDYsICdEJzogNSB9O1xyXG4gICAgbGV0IHRvdGFsQ3JlZGl0UG9pbnRzID0gMDtcclxuICAgIGxldCB0b3RhbEdyYWRlUG9pbnRzID0gMDtcclxuXHJcbiAgICBmb3IgKGNvbnN0IHN1YmplY3QgaW4gbWFya3MpIHtcclxuICAgICAgICBjb25zdCBncmFkZSA9IGNhbGN1bGF0ZUdyYWRlKG1hcmtzW3N1YmplY3RdKTtcclxuICAgICAgICBjb25zdCBjcmVkaXRQb2ludCA9IGNyZWRpdFBvaW50c1tzdWJqZWN0XTtcclxuICAgICAgICBjb25zdCBncmFkZVZhbHVlID0gZ3JhZGVWYWx1ZXNbZ3JhZGVdO1xyXG5cclxuICAgICAgICB0b3RhbENyZWRpdFBvaW50cyArPSBjcmVkaXRQb2ludDtcclxuICAgICAgICB0b3RhbEdyYWRlUG9pbnRzICs9IGdyYWRlVmFsdWUgKiBjcmVkaXRQb2ludDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdG90YWxHcmFkZVBvaW50cyAvIHRvdGFsQ3JlZGl0UG9pbnRzO1xyXG59XHJcblxyXG5cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGNhbGN1bGF0ZXJlc3VsdHMoY3N2Q29udGVudDpzdHJpbmcpe1xyXG4gICAgY29uc3Qgcm93cyA9IGNzdkNvbnRlbnQuc3BsaXQoJ1xcbicpLnNsaWNlKDEpO1xyXG4gICAgY29uc3QgZGF0YSA9IHJvd3MubWFwKHJvdyA9PiB7XHJcbiAgICAgICAgY29uc3QgW05hbWUsIFRhbWlsLCBFbmdsaXNoLCBNYXRocywgU2NpZW5jZSwgU29jaWFsXSA9IHJvdy5zcGxpdCgnLCcpLm1hcChpdGVtID0+IGl0ZW0udHJpbSgpKTtcclxuICAgICAgICBjb25zdCBHUEEgPSBjYWxjdWxhdGVHUEEoeyBUYW1pbDogK1RhbWlsLCBFbmdsaXNoOiArRW5nbGlzaCwgTWF0aHM6ICtNYXRocywgU2NpZW5jZTogK1NjaWVuY2UsIFNvY2lhbDogK1NvY2lhbCB9KTtcclxuICAgIFxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIE5hbWUsXHJcbiAgICAgICAgICAgIFRhbWlsOiBjYWxjdWxhdGVHcmFkZSgrVGFtaWwpLFxyXG4gICAgICAgICAgICBFbmdsaXNoOiBjYWxjdWxhdGVHcmFkZSgrRW5nbGlzaCksXHJcbiAgICAgICAgICAgIE1hdGhzOiBjYWxjdWxhdGVHcmFkZSgrTWF0aHMpLFxyXG4gICAgICAgICAgICBTY2llbmNlOiBjYWxjdWxhdGVHcmFkZSgrU2NpZW5jZSksXHJcbiAgICAgICAgICAgIFNvY2lhbDogY2FsY3VsYXRlR3JhZGUoK1NvY2lhbCksXHJcbiAgICAgICAgICAgIEdQQTogR1BBLnRvRml4ZWQoMilcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICBhd2FpdCBBV1NhZGREb2N1bWVudChkYXRhKTtcclxuICAgcmV0dXJuIGRhdGEgO1xyXG59XHJcblxyXG4gYXN5bmMgZnVuY3Rpb24gQVdTYWRkRG9jdW1lbnQoZGF0YTpvYmplY3Qpe1xyXG4gICAgY29uc3QgZGRiID0gbmV3IEFXUy5EeW5hbW9EQi5Eb2N1bWVudENsaWVudCgpO1xyXG4gICAgY29uc3QgcGFyYW1zOlB1dEl0ZW1JbnB1dCA9IHtcclxuICAgICAgVGFibGVOYW1lOiBcIlJlc3VsdHNcIixcclxuICAgICAgSXRlbTogIGRhdGEgYXMgUHV0SXRlbUlucHV0QXR0cmlidXRlTWFwLFxyXG4gIH07XHJcbiAgICAgdHJ5e1xyXG4gICAgICAgIGF3YWl0IGRkYi5wdXQocGFyYW1zKS5wcm9taXNlKClcclxuICAgICAgICByZXR1cm4gcGFyYW1zLkl0ZW07XHJcbiAgICAgfWNhdGNoIChlcnJvcil7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFkZGluZyBkb2N1bWVudDonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxuICB9Il19